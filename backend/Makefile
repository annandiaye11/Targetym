# Makefile pour Targetym AI Backend

.PHONY: dev prod stop install clean help

# Variables
VENV = ../.venv
PYTHON = $(VENV)/bin/python
UVICORN = $(VENV)/bin/uvicorn

help: ## Afficher cette aide
	@echo "üéØ Commandes disponibles pour Targetym AI Backend:"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-12s\033[0m %s\n", $$1, $$2}'

dev: ## Lancer en mode d√©veloppement avec auto-reload
	@echo "üöÄ D√©marrage backend en mode D√âVELOPPEMENT..."
	@echo "üìç http://localhost:8000 | üìö http://localhost:8000/docs"
	@cd $(dir $(realpath $(firstword $(MAKEFILE_LIST)))) && \
	$(UVICORN) main_postgresql:app --reload --host 0.0.0.0 --port 8000

prod: ## Lancer en mode production
	@echo "üè≠ D√©marrage backend en mode PRODUCTION..."
	@echo "üìç http://localhost:8000"
	@cd $(dir $(realpath $(firstword $(MAKEFILE_LIST)))) && \
	$(UVICORN) main_postgresql:app --host 0.0.0.0 --port 8000 --workers 4

stop: ## Arr√™ter le backend
	@echo "üõë Arr√™t du backend..."
	@pkill -f "main_postgresql" 2>/dev/null || true
	@pkill -f "uvicorn.*main_postgresql" 2>/dev/null || true
	@echo "‚úÖ Backend arr√™t√©"

install: ## Installer les d√©pendances
	@echo "üì¶ Installation des d√©pendances..."
	@$(VENV)/bin/pip install -r requirements.txt

clean: ## Nettoyer les fichiers temporaires
	@echo "üßπ Nettoyage..."
	@find . -type f -name "*.pyc" -delete
	@find . -type d -name "__pycache__" -delete

logs: ## Afficher les logs en temps r√©el (si en arri√®re-plan)
	@echo "üìã Logs du backend:"
	@tail -f /tmp/targetym-backend.log 2>/dev/null || echo "Aucun log trouv√©"
